<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>个性定制</title>
    <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
<div class="include-page" data-src="public/head-top.html"></div>
    <div class="gexingdingzhi-page main">
        <div class="include-page" data-src="public/head.html"></div>
        <div class="top-banner ef-slide">
            <ul>
                <li>
                    <a href="##" class="a">
                        <img src="img/temp/b1.png" alt="" class="img"/>
                    </a>
                </li>
                <li>
                    <a href="##" class="a">
                        <img src="img/temp/b1.png" alt="" class="img"/>
                    </a>
                </li>
                <li>
                    <a href="##" class="a">
                        <img src="img/temp/b1.png" alt="" class="img"/>
                    </a>
                </li>
            </ul>
        </div>
        <p class="eff-head">效果展示</p>
        <div class="div-wrap">
            <h2 class="h2">My Ksana</h2>
            <div class="show-box">
                <div class="img-box">
                    <img src="img/temp/l1.png" alt="" class="img"/>
                </div>
                <div class="list-box">
                    <h3 class="h3">为您推荐</h3>
                    <div class="img-list-box" id="imgList">
                        <div class="img-list-wrap cl">
                            <a href="##" class="a" data-position="60">
                                <img src="img/temp/c1.png" alt="" class="img"/>
                                <p class="p">RMB 399.00</p>
                            </a>
                            <a href="##" class="a" data-position="30">
                                <img src="img/temp/c2.png" alt="" class="img"/>
                                <p class="p">RMB 399.00</p>
                            </a>
                            <a href="##" class="a" data-position="90">
                                <img src="img/temp/c3.png" alt="" class="img"/>
                                <p class="p">RMB 399.00</p>
                            </a>
                            <a href="##" class="a" data-position="60">
                                <img src="img/temp/c1.png" alt="" class="img"/>
                                <p class="p">RMB 399.00</p>
                            </a>
                            <a href="##" class="a" data-position="30">
                                <img src="img/temp/c2.png" alt="" class="img"/>
                                <p class="p">RMB 399.00</p>
                            </a>
                            <a href="##" class="a" data-position="60">
                                <img src="img/temp/c1.png" alt="" class="img"/>
                                <p class="p">RMB 399.00</p>
                            </a>
                            <a href="##" class="a" data-position="30">
                                <img src="img/temp/c2.png" alt="" class="img"/>
                                <p class="p">RMB 399.00</p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="material-box cl">
                <div class="material-wrap">
                    <h3 class="h3">材质选择：皮绳</h3>
                    <div class="list-box">
                        <div class="list-wrap cl">
                            <a href="##" class="a cur">皮绳</a>
                            <a href="##" class="a">蜡绳</a>
                            <a href="##" class="a">蜡绳</a>
                            <a href="##" class="a">蜡绳</a>
                        </div>
                    </div>
                </div>
                <div class="material-wrap">
                    <h3 class="h3">颜色选择：红色</h3>
                    <div class="list-box">
                        <div class="list-wrap cl">
                            <a href="##" class="a1 cur" style="background: red;"></a>
                            <a href="##" class="a1" style="background: blue;"></a>
                            <a href="##" class="a1" style="background: blue;"></a>
                            <a href="##" class="a1" style="background: blue;"></a>
                        </div>
                    </div>
                </div>
                <div class="material-wrap">
                    <h3 class="h3">银扣：笑脸</h3>
                    <div class="list-box">
                        <div class="list-wrap cl" style="margin-top: -4px;margin-left: 14px;">
                            <a href="##" class="a2">
                                <img src="img/temp/4.png" alt="" class="img"/>
                                <div class="zoom-mask">
                                    <img src="img/temp/4.png" alt="" class="img1"/>
                                </div>
                            </a>
                            <a href="##" class="a2">
                                <img src="img/temp/4.png" alt="" class="img"/>
                                <div class="zoom-mask">
                                    <img src="img/temp/4.png" alt="" class="img1"/>
                                </div>
                            </a>
                            <a href="##" class="a2">
                                <img src="img/temp/4.png" alt="" class="img"/>
                                <div class="zoom-mask">
                                    <img src="img/temp/4.png" alt="" class="img1"/>
                                </div>
                            </a>
                            <a href="##" class="a2">
                                <img src="img/temp/4.png" alt="" class="img"/>
                                <div class="zoom-mask">
                                    <img src="img/temp/4.png" alt="" class="img1"/>
                                </div>
                            </a>
                            <a href="##" class="a2">
                                <img src="img/temp/4.png" alt="" class="img"/>
                                <div class="zoom-mask">
                                    <img src="img/temp/4.png" alt="" class="img1"/>
                                </div>
                            </a>

                        </div>
                    </div>
                </div>
                <div class="material-wrap">
                    <h3 class="h3">手链尺寸：16CM</h3>
                    <div class="list-box">
                        <div class="list-wrap cl">
                            <a href="##" class="a cur">16CM</a>
                            <a href="##" class="a">18CM</a>
                            <a href="##" class="a">18CM</a>
                            <a href="##" class="a">18CM</a>
                        </div>
                    </div>
                </div>
                <div class="material-wrap">
                    <h3 class="h3">手链尺寸：16CM</h3>
                    <div class="list-box">
                        <div class="list-wrap cl">
                            <a href="##" class="a cur">16CM</a>
                            <a href="##" class="a">18CM</a>
                            <a href="##" class="a">18CM</a>
                            <a href="##" class="a">18CM</a>
                        </div>
                    </div>
                </div>
                <em class="em" style="left: 230px;"></em>
                <em class="em" style="left: 461px;"></em>
                <em class="em" style="left: 693px;"></em>
                <em class="em" style="left: 924px;"></em>
                <a href="##" class="guide">尺码指南
                    <img src="img/temp/7.png" alt="" class="img"/>
                </a>
            </div>
            <div class="money-box">
                总额：<span class="span">1596.00</span>
            </div>
            <div class="div">
                <a href="querendingdan.html" class="btn fr">立即购买</a>
                <a href="##" class="btn">加入购物车</a>
            </div>
            <div class="div2">
                <a href="##" class="a back">返回</a>
            </div>
        </div>
    </div>
<div class="include-page" data-src="public/foot.html"></div>
<div class="include-page" data-src="public/loginDialog.html"></div>
</body>
<script type="text/javascript" src="js/lib/jquery1.7.js"></script>
<script type="text/javascript" src="js/lib/jquery.nicescroll.js"></script>
<script type="text/javascript" src="js/include.js"></script>
<script type="text/javascript" src="js/public.js"></script>
<script type="text/javascript">
    $(function () {
        new Slide({
            loopPlay:true,
            autoPlay:true,
            navigateBtn:true,
            navigateBtnType:"icon",
            slideBtn:true
        }).start();

        //滚动条
        $('#imgList').niceScroll({touchbehavior:false,cursorcolor:"#b5b5b5"});

        /*
        * 参数说明
        * src：图片来源
        * position:配件图片的孔距离图片顶端的位置（到时候由美工提供，然后后台保存到数据库，图片大小为120*120）
        * */
        var arr = [{
            src:"img/temp/c1.png",
            position:60,
            title:"图片1"
        },{
            src:"img/temp/c2.png",
            position:30,
            title:"图片2"
        },{
            src:"img/temp/c3.png",
            position:90,
            title:"图片3"
        },{
            src:"img/temp/c2.png",
            position:30,
            title:"图片2"
        },{
            src:"img/temp/c3.png",
            position:90,
            title:"图片3"
        },{
            src:"img/temp/c2.png",
            position:30,
            title:"图片2"
        },{
            src:"img/temp/c3.png",
            position:90,
            title:"图片3"
        }];

        (function(arr){
            var $box = $(".show-box");
            var context,context1,flag = false;
            //图片高度和宽度，绳子高度，绳子margintop值，盒子宽度，样式已经写好，请勿修改
            var imgWidth = 120,imgHeight=120,lineHeight = 16,marginTop=213,boxWidth=1158;
            //识别范围
            var range = {
                min:marginTop+lineHeight/2-30/2,
                max:marginTop+lineHeight/2+30/2,
            };
            //屏蔽右键菜单
            $box.on("mouseenter", function () {
                document.oncontextmenu= function () {
                    return false;
                };
            });
            //恢复右键菜单
            $box.on("mouseleave", function () {
                document.oncontextmenu=null;
            });
            //删除按钮
            $box.on("click",".close", function () {
                $(this).parent().remove();
                return false;
            });
            //删除按钮显示&&隐藏
            $box.on("mouseenter",".move-img", function () {
                $(this).find(".close").show();
                return false;
            });
            $box.on("mouseleave",".move-img", function () {
                $(this).find(".close").hide();
                return false;
            });
            //计算图片位置
            function getOffset(obj,e,offsetTop,offsetLeft){
                var offset = {};
                //如果不存在，则是从下面的拖拽
                offsetTop = offsetTop || imgHeight/2;
                offsetLeft = offsetLeft || imgWidth/2;
                offset.top =  e.pageY - obj.offset().top - offsetTop;
                offset.left = e.pageX - obj.offset().left - offsetLeft;
                return offset;
            }
            //获得html
            function getMoveImgHtml(src,top,left,position,title){
                var html = "";
                html += "<a class='move-img' href='javascript:void(0);' data-position='"+position+"' style='top:"+top+"px;left:"+left+"px;'>";
                html += "<i class='icon close'></i>";
                html += "<img src='"+src+"' class='img' title='"+title+"'/>";
                html += "</a>";
                return html;
            }
            //鼠标按下事件
            $('#imgList').on("mousedown",".a", function (e) {
                var offset = getOffset($box,e);
                var src = $(this).find(".img").attr("src");
                var position = $(this).data("position");
                var title = $(this).find(".img").attr("title");
                //追加节点
                $box.append(getMoveImgHtml(src,offset.top,offset.left,position,title));
                //隐藏图片
                context1 = $(this).find(".img").hide();
                //触发按下事件
                $box.find(".move-img:last").trigger("mousedown");
            });
            var offsetX = 0,offsetY = 0;
            $box.on("mousedown",".move-img",function (e) {
                //计算鼠标和图片边缘的相对距离
                offsetX = e.pageX - $(this).offset().left;
                offsetY = e.pageY - $(this).offset().top;
                //空间层叠位置
                context = $(this).css({
                    "z-index":1
                });
                //隐藏按钮
                $(this).find(".close").hide();
                flag = true;
                return false;
            });
            $(document).on("mousemove", function (e) {
                if(flag){
                    var offset = getOffset($box,e,offsetY,offsetX);
                    var position = context.data("position");
                    var dis = offset.top + position;
                    //靠近识别
                    if(range.min <= dis && dis <= range.max){
                        offset.top = marginTop + lineHeight/2 - position;
                    }
                    context.css({
                        "top":offset.top+"px",
                        "left":offset.left+"px"
                    });
                    return false;
                }
            });
            $(document).on("mouseup", function () {
                if(flag){
                    if(context1){
                        //图片显示
                        context1.show();
                    }
                    context.css({
                        "z-index":0
                    });
                    flag = false;
                    //释放内存
                    context = context1 = null;
                    return false;
                }
            });
            //初始化开始的装饰小物件代码
            function init(arr){
                var html = "",l = arr.length;
                var left = (boxWidth - l * imgWidth)/2;
                var top = marginTop+lineHeight/2;
                for(var i= 0;i<l;i++){
                    html += getMoveImgHtml(arr[i].src,top-arr[i].position,left,arr[i].position,arr[i].title);
                    left += imgWidth;
                }
                $box.append(html);
            }
            init(arr);
        })(arr);
    });
</script>
</html>